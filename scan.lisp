(in-package cylon)

(defparameter *tab-size* 8)

(defvar *look*)
(defvar *column*)
(defvar *indent-stack*)

(defun init ()
  (setf *column* 0)
  (setf *indent-stack* '(0))
  (setf *look* (read-char *standard-input* nil :eof)))

(defun getchar ()
  (assert (not (eq *look* :eof)))
  (setf *column*
        (+ *column*
           (if (eq #\tab *look*) *tab-size* 1)))
  (prog1
      *look*
    (setf *look* (read-char *standard-input* nil :eof))))

(defun emit (&rest items)
  (format t " 狺轸屙螬ㄤ彐躅屙轸祛é蝈篝轸屙螬ㄡ痧禊＇屙轸轸屙螬ㄦ矧磲Β┅ㄤ彐躅屮疱泗邃ㄥ疱泗邃ㄥ蝌矧ㄣ镱汜翦钺翦篝蜷铉⑴疱泗邃Б屮疱泗邃Б┅ㄤ彐躅麒轸弩疳沐īㄦ轭祜镫Ж＼箴徙＼翎猢┅ㄤ彐躅钺礤īㄡ祓栳汨狎祜镫┅ㄤ彐躅轭钺礤īㄡ祓栳铛礤蜷沭祜镫┅ㄤ彐躅铛礅弪īㄤ殓轸汨狎祜镫┅ㄤ彐躅铄黛轭瀛īㄥ＼铄黛轭祜镫┅ㄤ彐躅屣姝īㄥ哄镦祜镫┅ㄤ彐躅篝蜷铉īㄦ轭祜镫Ж＼＼З┅ㄤ彐躅轭溴铘ī泔祯眍ㄣ狎轭溴铘篝徙氇┅ㄤ彐躅溴溴铘ī泔祯眍ㄣ狎轭溴铘篝徙氇┅ㄤ彐躅麒轸弩疳沐ī祜镳麒殪麒轸弩疳沐皓滹ㄧ弭汨狎┅瑚栝翦箴徙濠ㄤ彐躅铄黛轭īㄩ铒铄黛轭瀛皓ㄥ疱泗邃⑽抛躺闻┅ㄧ弭汨狎ㄥ黹侯鬻扉铄箦翩泔祯眍癌麒轸弩疳沐ㄣ镱è铄黛轭瀛皓铄黛轭濠è轭溴铘皓ㄩ钿孱舂è溴溴铘皓ㄤ邃孱舂┅ㄤ彐躅轭溴铘īㄥ黹洪钿孱舂瘐箬泔祯眍轭溴铘篝徙氇┅ㄤ彐躅溴溴铘ī祜镳麒殪泔祯眍ㄣ狎轭溴铘篝徙氇┅滹痫轭溴铘篝徙氇ㄥ黹轰邃孱舂ㄡ篌弪ㄥ泔祯眍ㄣ狎轭溴铘篝徙氇┅┅ㄤ彐躅钺礤īㄥ黹ㄣ镥蜚祜镳麒殪ㄩ瞽钺礤皓泔祆邈糸铉ㄧ弭汨狎┅篝蜷铉┅ㄤ彐躅珏舡铛礅弪īㄥ黹ㄣ镥蜚祜镳麒殪铛礅弪皓泔祆邈糸铉ㄧ弭汨狎┅篝蜷铉┅ㄤ彐躅麸脲īㄣ镱è钺礤皓钺礤┅è铛礅弪皓ㄧ弭铛礅弪┅换è篝蜷铉皓篝蜷铉┅ㄥ疱泗邃Ⅳ镫孱┅麒轸弩疳沐┅ㄤ彐躅扉铄ī祜镳麒殪铒铄黛轭瀛皓滹麸脲瞟ㄩ铒ㄥ镦皓铄黛轭濠┅ㄤ彐躅扉铄ī祜镳麒殪铒ㄥ镦皓滹扉铄┅